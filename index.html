<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

</head>
<body>

<iframe id="video" width="560" height="315" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<button id="nextButton">Next</button>
<script src="https://www.youtube.com/iframe_api"></script>
<script>

var watchCount = 0;
var watchedVideos = {};
var tree = "";
var treeCount = 0;

var firstVideo = "https://www.youtube.com/embed/xNN7iTA57jM?enablejsapi=1"
var allTrees = ["https://www.youtube.com/embed/ei63l74d2SU?enablejsapi=1","https://www.youtube.com/embed/UA6Aku10nPo?enablejsapi=1","https://www.youtube.com/embed/espl4s36T3I?enablejsapi=1","https://www.youtube.com/embed/aTcj3Q2Y6Bk?enablejsapi=1","https://www.youtube.com/embed/e9dKQtpbP6o?enablejsapi=1","https://www.youtube.com/embed/qiEqirYypZs?enablejsapi=1","https://www.youtube.com/embed/wNHdZeucb9g?enablejsapi=1","https://www.youtube.com/embed/OOHk1gULkMM?enablejsapi=1","https://www.youtube.com/embed/CeHxIjr0xIw?enablejsapi=1","https://www.youtube.com/embed/GmoVQi6kg7k?enablejsapi=1","https://www.youtube.com/embed/kbbUTOujKZA?enablejsapi=1","https://www.youtube.com/embed/coNJ3lEisHM?enablejsapi=1","https://www.youtube.com/embed/alU8maHouhA?enablejsapi=1","https://www.youtube.com/embed/-yEXN7-vt00?enablejsapi=1","https://www.youtube.com/embed/Ip46WP_kKtM?enablejsapi=1","https://www.youtube.com/embed/MgqScB8Mzvw?enablejsapi=1","https://www.youtube.com/embed/IypPSDdF-3c?enablejsapi=1","https://www.youtube.com/embed/opxDgcVkcvE?enablejsapi=1","https://www.youtube.com/embed/UeAFwfgOBbs?enablejsapi=1","https://www.youtube.com/embed/cOtVZwhz1cg?enablejsapi=1","https://www.youtube.com/embed/eaBGpcKDs3g?enablejsapi=1","https://www.youtube.com/embed/oCPFDze0L8c?enablejsapi=1","https://www.youtube.com/embed/QRQLne4RNUw?enablejsapi=1","https://www.youtube.com/embed/DCfCVsusK5M?enablejsapi=1","https://www.youtube.com/embed/osgijZULgUo?enablejsapi=1"]

var allTreesId = ["ei63l74d2SU","UA6Aku10nPo","espl4s36T3I","aTcj3Q2Y6Bk","e9dKQtpbP6o","qiEqirYypZs","wNHdZeucb9g","OOHk1gULkMM","CeHxIjr0xIw","GmoVQi6kg7k","kbbUTOujKZA","coNJ3lEisHM","alU8maHouhA","-yEXN7-vt00","Ip46WP_kKtM","MgqScB8Mzvw","IypPSDdF-3c","opxDgcVkcvE","UeAFwfgOBbs","cOtVZwhz1cg","eaBGpcKDs3g","oCPFDze0L8c","QRQLne4RNUw","DCfCVsusK5M","osgijZULgUo"]

// Set first video by hand
var element2 = document.getElementById("video")
element2.src = firstVideo


function nextVideo(){
  while (tree in watchedVideos || !watchCount && !tree) {
    treeCount = Math.floor(Math.random() * (allTrees.length))
    tree = allTreesId[treeCount]
  }
  watchedVideos[tree] = 1
  watchCount++
  tree = allTreesId[treeCount]

  console.log (tree)

  if (watchCount >= 16){
    // Last video
    
    document.getElementById("nextButton").style.display = "initial"
    document.getElementById("nextButton").innerHTML = "Take Another Walk"
    return "xNN7iTA57jM"
  }
  if (watchCount > 0){
    document.getElementById("nextButton").style.display = "none"
  }
  return tree
}

var ik_player;
window.onYouTubePlayerReady = function(event) {
  console.log('Video is ready to play');
}

window.onYouTubePlayerStateChange = function(event) {
  console.log(event.data)
  console.log("State change")
  if (event.data === YT.PlayerState.ENDED) {
    var vidId = nextVideo()
    console.log(vidId, "Loading")
    event.target.cueVideoById(vidId, 0)

  }
if (event.data === YT.PlayerState.CUED) {
    event.target.playVideo()
  }
}

window.onYouTubeIframeAPIReady = function() {
  ik_player = new YT.Player('video');
       
  console.log('Video API is loaded');
       
  ik_player.addEventListener("onReady",       "onYouTubePlayerReady");
  ik_player.addEventListener("onStateChange", "onYouTubePlayerStateChange");
}

var anotherbutton = document.getElementById("nextButton")
anotherbutton.addEventListener("click", function() {
  watchCount = 1;
  watchedVideos = {};
  tree = "";
  var vidId = nextVideo()
  console.log(vidId, "Loading")
  ik_player.cueVideoById(vidId, 0)
})
</script>
</body>
</html>
